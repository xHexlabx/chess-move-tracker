# Chess Move Tracker Project

‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á Pipeline ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏´‡∏°‡∏≤‡∏Å‡∏£‡∏∏‡∏Å‡∏à‡∏≤‡∏Å‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ ‡πÅ‡∏•‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô PGN ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Computer Vision ‡πÅ‡∏•‡∏∞ Deep Learning (PyTorch Lightning)

---

## üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (‡∏ó‡∏î‡∏™‡∏≠‡∏ö State 1 + 2)

‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö Pipeline (State 1: Board Localisation + State 2: Occupancy Classification)

### 1. ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Environment

‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ `conda` ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ dependencies

```bash
# ‡∏™‡∏£‡πâ‡∏≤‡∏á environment ‡πÉ‡∏´‡∏°‡πà‡∏ä‡∏∑‡πà‡∏≠ chess_tracker
conda env create -f environment.yml

# ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô environment
conda activate chess_tracker
````

### 2\. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÇ‡∏°‡πÄ‡∏î‡∏• (Dummy)

‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå `visualize_state2.py` ‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ **Dummy Model** (‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á) ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∂‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ

### 3\. ‡∏£‡∏±‡∏ô‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏ó‡∏î‡∏™‡∏≠‡∏ö

‡∏£‡∏±‡∏ô‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå `visualize_state2.py` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á State 1 (Warping) ‡πÅ‡∏•‡∏∞ State 2 (Dummy Classification)

1.  **‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏†‡∏≤‡∏û:** ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏†‡∏≤‡∏û (‡πÄ‡∏ä‡πà‡∏ô `test_image_1.jpg`) ‡πÉ‡∏ô `data/raw/images/single_test/`
2.  **‡∏£‡∏±‡∏ô‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå:**
    ```bash
    python scripts/visualize_state2.py
    ```

‡∏´‡∏≤‡∏Å‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á Matplotlib ‡πÅ‡∏™‡∏î‡∏á 3 ‡∏†‡∏≤‡∏û:

1.  **Original Image**: ‡∏†‡∏≤‡∏û‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö
2.  **State 1: Warped Board**: ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å Warp ‡πÅ‡∏•‡∏∞‡∏´‡∏°‡∏∏‡∏ô‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á (‡∏Ç‡∏≤‡∏ß‡∏•‡πà‡∏≤‡∏á-‡∏î‡∏≥‡∏ö‡∏ô)
3.  **State 2: Occupancy Result**: ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏î "O" (Occupied) ‡πÅ‡∏•‡∏∞ "E" (Empty) ‡∏ó‡∏±‡∏ö (‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏≤‡∏Å Dummy Model)

-----

## ü§ñ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏ô‡πÇ‡∏°‡πÄ‡∏î‡∏• State 2 (Occupancy)

‡∏´‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏ô‡πÇ‡∏°‡πÄ‡∏î‡∏• AI ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏≠‡∏á (‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Dummy Model) ‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô 2.1: ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Few-Shot Auto-Labeling)

‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Dataset) ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏û "‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô" (Starting Position)

1.  **‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏†‡∏≤‡∏û:**

      * ‡∏ô‡∏≥‡∏†‡∏≤‡∏û "‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô" ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ **‡πÄ‡∏ó‡∏£‡∏ô** ‡πÑ‡∏õ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô `data/raw/images/single_test/` ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ `white_view_` ‡∏´‡∏£‡∏∑‡∏≠ `black_view_` (‡πÄ‡∏ä‡πà‡∏ô `white_view_1.jpg`)
      * ‡∏ô‡∏≥‡∏†‡∏≤‡∏û "‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô" ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ **‡∏ß‡∏±‡∏î‡∏ú‡∏• (Validation)** ‡πÑ‡∏õ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô (‡πÄ‡∏ä‡πà‡∏ô `test_image_1.jpg`, `test_image_2.jpg`)

2.  **‡∏£‡∏±‡∏ô‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:**

    ```bash
    python scripts/prepare_fewshot_data.py
    ```

      * ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏™‡πÅ‡∏Å‡∏ô‡∏†‡∏≤‡∏û, ‡∏£‡∏±‡∏ô State 1, ‡∏ï‡∏±‡∏î 64 ‡∏ä‡πà‡∏≠‡∏á, ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏õ‡πâ‡∏≤‡∏¢ (Label) ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏á‡πÉ‡∏ô `data/processed/occupancy_dataset/` (‡πÅ‡∏ö‡πà‡∏á `train` / `val` ‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå)

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô 2.2: ‡∏£‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏ô (PyTorch Lightning)

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏£‡πâ‡∏≠‡∏° ‡∏£‡∏±‡∏ô‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡πÄ‡∏ó‡∏£‡∏ô:

```bash
python scripts/train_occupancy.py
```

  * ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏à‡∏∞:
    1.  ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å `.../train/` ‡πÅ‡∏•‡∏∞ `.../val/` (‡πÇ‡∏î‡∏¢ `OccupancyDataModule`)
    2.  ‡πÉ‡∏ä‡πâ **Data Augmentation** ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏´‡∏ô‡∏±‡∏Å‡∏Å‡∏±‡∏ö‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Train
    3.  ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏ó‡∏£‡∏ô‡πÇ‡∏°‡πÄ‡∏î‡∏• `OccupancyLitModel` (ResNet18)
    4.  ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• `val_acc` (‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î‡∏ú‡∏•)
    5.  ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (Best Checkpoint) ‡πÑ‡∏õ‡∏ó‡∏µ‡πà `models/occupancy/occupancy_model_best.ckpt`

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô 2.3: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏à‡∏£‡∏¥‡∏á

1.  ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå `scripts/visualize_state2.py`

2.  ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç 2 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ:

    ```python
    # Path ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÑ‡∏ü‡∏•‡πå checkpoint ‡∏ó‡∏µ‡πà‡πÄ‡∏ó‡∏£‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à
    MODEL_CHECKPOINT_PATH = "models/occupancy/occupancy_model_best.ckpt" 

    # ‡∏õ‡∏¥‡∏î Dummy Model
    USE_DUMMY_MODEL = False
    ```

3.  ‡∏£‡∏±‡∏ô‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á:

    ```bash
    python scripts/visualize_state2.py
    ```

    ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ ‡∏†‡∏≤‡∏û‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå "State 2" ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏à‡∏≤‡∏Å AI ‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏¥‡πà‡∏á‡πÄ‡∏ó‡∏£‡∏ô\!

-----

## üéØ Pipeline Overview

### State 1: Board Localisation (‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß)

  * **‡∏£‡∏±‡∏ö:** ‡∏†‡∏≤‡∏û‡∏î‡∏¥‡∏ö (BGR)
  * **‡∏ó‡∏≥:** Mask ‡∏™‡∏µ $\rightarrow$ ‡∏´‡∏≤ Contour $\rightarrow$ ‡∏´‡∏≤ Convex Hull $\rightarrow$ ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 4 ‡∏°‡∏∏‡∏° $\rightarrow$ Warp ‡∏†‡∏≤‡∏û $\rightarrow$ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏µ‡∏´‡∏°‡∏≤‡∏Å (‡∏Ç‡∏≤‡∏ß/‡∏î‡∏≥) $\rightarrow$ ‡∏´‡∏°‡∏∏‡∏ô‡∏†‡∏≤‡∏û‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ó‡∏¥‡∏®
  * **‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤:** `WarpedImage` (‡∏†‡∏≤‡∏û‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô 600x600 ‡∏ó‡∏µ‡πà‡∏°‡∏µ "‡∏´‡∏°‡∏≤‡∏Å‡∏Ç‡∏≤‡∏ß" ‡∏≠‡∏¢‡∏π‡πà‡∏•‡πà‡∏≤‡∏á)

### State 2: Occupancy Classification (‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß)

  * **‡∏£‡∏±‡∏ö:** `WarpedImage`
  * **‡∏ó‡∏≥:** ‡∏ï‡∏±‡∏î 64 ‡∏ä‡πà‡∏≠‡∏á (‡∏û‡∏£‡πâ‡∏≠‡∏° Context) $\rightarrow$ ‡∏õ‡πâ‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÇ‡∏°‡πÄ‡∏î‡∏• `OccupancyLitModel` (ResNet18)
  * **‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤:** `OccupancyGrid` (List 64 bools)

### State 3: Piece Classification (‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ)

  * **‡∏£‡∏±‡∏ö:** `WarpedImage` ‡πÅ‡∏•‡∏∞ `OccupancyGrid`
  * **‡∏ó‡∏≥:** ‡∏ï‡∏±‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏´‡∏°‡∏≤‡∏Å (`True`) $\rightarrow$ ‡∏õ‡πâ‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÇ‡∏°‡πÄ‡∏î‡∏• (12-class CNN)
  * **‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤:** `PieceGrid` (List 64 strings: 'wP', 'bN', 'empty', ...)

<!-- end list -->
